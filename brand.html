<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mall Mart KIOSK</title>
<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:"Segoe UI", Arial, sans-serif;
  user-select:none;
}

body{ background:#f8f9fb; }

/* Sidebar */
.side-menu{
  position:fixed;
  left:0;
  top:0;
  width:220px;
  height:100vh;
  background:#fff;
  border-right:1px solid #e0e0e0;
}

.menu-title{
  background:#1a4fd8;
  color:#fff;
  text-align:center;
  padding:18px;
  font-weight:600;
  letter-spacing:4px;
}

.side-menu a{
  display:block;
  padding:18px 20px;
  text-decoration:none;
  color:#333;
  border-bottom:1px solid #f0f0f0;
}

.side-menu a.active{
  background:#eef3ff;
  color:#1a4fd8;
  font-weight:600;
}

/* Main */
.main-content{
  margin-left:220px;
  padding:30px;
}

.page-title{
  font-size:26px;
  margin-bottom:6px;
}

.page-subtitle{
  color:#666;
  margin-bottom:25px;
}

/* Cards */
.shop-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(280px,1fr));
  gap:25px;
}

.shop-card{
  background:#fff;
  border-radius:18px;
  box-shadow:0 12px 25px rgba(0,0,0,0.12);
  overflow:hidden;
}

.logo-box{
  background:#f3f4f6;
  padding:20px;
  text-align:center;
}

.logo-box img{
  width:110px;
  height:110px;
  object-fit:contain;
  mix-blend-mode:multiply;
}

.shop-info{
  padding:18px;
  text-align:center;
}

.category{ color:#555; font-size:14px; }
.floor{ color:#777; font-size:14px; margin-top:6px; }
.rating{ margin-top:8px; font-weight:600; color:#f39c12; }

/* Buttons */
.shop-buttons{
  display:flex;
  justify-content:space-evenly;
  padding:15px 20px;
}

.shop-buttons button{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px 18px;
  font-weight:600;
  font-size:14px;
  border:2px solid #1a4fd8;
  background:#fff;
  color:#1a4fd8;
  transition:0.3s;
}

.location-btn{
  border-top-left-radius:25px;
  border-bottom-left-radius:25px;
}

.review-btn{
  border-top-right-radius:25px;
  border-bottom-right-radius:25px;
}

.shop-buttons button:active{
  background:#1a4fd8;
  color:#fff;
}

.shop-buttons svg{
  width:18px;
  height:18px;
  fill:currentColor;
}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:#fff;
  padding:25px;
  width:280px;
  border-radius:12px;
  text-align:center;
}

.stars{
  font-size:30px;
  margin:15px 0;
}

.stars span{ color:#ccc; }
.stars span.active{ color:#f39c12; }

.modal button{
  margin-top:10px;
  padding:8px 15px;
  border:none;
  background:#1a4fd8;
  color:#fff;
  border-radius:6px;
}
</style>
</head>

<body>

<div class="side-menu">
  <div class="menu-title">MENU BAR</div>
  <a href="index.html">Home</a>
  <a onclick="filterFloor('ground', this)" class="active">Ground Floor</a>
  <a onclick="filterFloor('1st', this)">1st Floor</a>
  <a onclick="filterFloor('2nd', this)">2nd Floor</a>
</div>

<div class="main-content">
  <!-- <div class="page-title">Welcome to MOLLI MART</div>
  <div class="page-subtitle">Tap location or rate store</div> -->
  <div class="shop-grid" id="shopGrid"></div>
</div>

<div class="modal" id="reviewModal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <div class="stars" id="starContainer"></div>
    <button onclick="submitReview()">Submit</button>
  </div>
</div>

<script>

let mallData = [];

document.addEventListener("DOMContentLoaded", function () {

  if (window.api && window.api.getBrands) {
    mallData = window.api.getBrands().brands;
    renderShops("ground");
  } else {
    fetch("brandshop.json")
      .then(response => response.json())
      .then(data => {
        mallData = data.brands;
        renderShops("ground");
      });
  }

});

let reviews = {};
let selectedShop = null;
let selectedRating = 0;

function renderShops(floor){

  const grid = document.getElementById("shopGrid");
  grid.innerHTML = "";

  const filtered = mallData.filter(s => s.floor === floor);

  filtered.forEach(shop => {

    grid.innerHTML += `
      <div class="shop-card">

        <div class="logo-box">
          <!-- <img src="${shop.image}" alt="${shop.name}"> -->
          <img src="${shop.image}" alt="${shop.name}">
        </div>

        <div class="shop-info">
          <div class="category">${shop.name}</div>
          <div class="floor">Shop ID : ${ shop.id} > ${shop.category.toUpperCase()}</div>
          <div class="rating" id="rating-${shop.id}">
            ${getAverageRating(shop.id)}
          </div>
        </div>

        <div class="shop-buttons">

          <button class="location-btn"
            onclick="goToMap('${shop.floor}', ${shop.id})">
            
            <!-- LOCATION SVG -->
            <svg viewBox="0 0 24 24">
              <path d="M12 2C8.1 2 5 5.1 5 9c0 5.3 7 13 7 13s7-7.7 7-13c0-3.9-3.1-7-7-7zm0 9.5c-1.4 0-2.5-1.1-2.5-2.5S10.6 6.5 12 6.5 14.5 7.6 14.5 9 13.4 11.5 12 11.5z"/>
            </svg>

            Location
          </button>

          <button class="review-btn"
            onclick="openReview(${shop.id})">

            <!-- STAR SVG -->
            <svg viewBox="0 0 24 24">
              <path d="M12 17.3l6.2 3.7-1.6-7L22 9.3l-7.1-.6L12 2 9.1 8.7 2 9.3l5.4 4.7-1.6 7z"/>
            </svg>

            Review
          </button>

        </div>
      </div>
    `;
  });
}

function filterFloor(floor, el){
  document.querySelectorAll(".side-menu a")
    .forEach(a => a.classList.remove("active"));
  el.classList.add("active");
  renderShops(floor);
}

function goToMap(floor, shopId){
  window.location.href =
    "map.html?floor=" + floor + "&shop=" + shopId;
}

function openReview(id){
  selectedShop = id;
  selectedRating = 0;

  const shop = mallData.find(s => s.id === id);
  document.getElementById("modalTitle").innerText =
    "Rate " + shop.name;

  document.getElementById("reviewModal").style.display = "flex";
  renderStars();
}

function renderStars(){
  const container = document.getElementById("starContainer");
  container.innerHTML = "";

  for(let i=1; i<=5; i++){
    const star = document.createElement("span");
    star.innerHTML = "★";

    if(i <= selectedRating)
      star.classList.add("active");

    star.onclick = function(){
      selectedRating = i;
      renderStars();
    };

    container.appendChild(star);
  }
}

function submitReview(){
  if(selectedRating === 0){
    alert("Please Rate before submitting");
    return;
  }

  if(!reviews[selectedShop])
    reviews[selectedShop] = [];

  reviews[selectedShop].push({rating:selectedRating});

  document.getElementById("rating-" + selectedShop)
    .innerText = getAverageRating(selectedShop);

  document.getElementById("reviewModal").style.display = "none";
}

function getAverageRating(id){
  if(!reviews[id])
    return "No ratings yet";

  const total = reviews[id].reduce((sum,r)=>sum+r.rating,0);
  const avg = (total / reviews[id].length).toFixed(1);
  return "⭐ " + avg + " / 5";
}

</script>

</body>
</html>